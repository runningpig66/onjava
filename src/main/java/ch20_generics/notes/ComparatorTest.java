package ch20_generics.notes;

import ch19_reflection.pets.Cat;
import ch19_reflection.pets.Manx;
import ch19_reflection.pets.Pet;

import java.util.ArrayList;
import java.util.Comparator;
import java.util.List;

/**
 * @author runningpig66
 * @date 2026/1/10 å‘¨å…­
 * @time 20:20
 * P.713 Â§20.10 é—®é¢˜ Â§20.10.5 åŸºç±»ä¼šåŠ«æŒæ¥å£
 * <p>
 * notes: 14-æ³›å‹é€†å˜ï¼šä»æ•°æ®è§†è§’åˆ°èƒ½åŠ›è§†è§’.md
 */
public class ComparatorTest {
    // ã€å¹³è¡Œå®‡å®™ã€‘ç³Ÿç³•çš„è®¾è®¡ï¼šæ³›å‹å‚æ•°å¿…é¡»ä¸¥æ ¼ä¸€è‡´ï¼ˆä¸å˜é‡ï¼‰
    public static <T> void sort0(List<T> list, Comparator<T> c0) {
        T t1 = list.get(0);
        T t2 = list.get(1);
        int compareResult = c0.compare(t1, t2);
        // æ’åºé€»è¾‘...
    }

    // 2. ä¸ºä»€ä¹ˆ sort1 çš„ compare æ— æ³•è°ƒç”¨ï¼Ÿâ€”â€” åå˜ï¼ˆCovarianceï¼‰å¯¼è‡´çš„â€œæ¶ˆè´¹è€…å°é”â€
    // sort1(List<T> list, Comparator<? extends T> c1) ä½¿ç”¨äº†ä¸Šç•Œé€šé…ç¬¦ï¼Œè¿™è¢«ç§°ä¸ºåå˜ä¸Šä¸‹æ–‡ã€‚
    // ä½ æ³¨é‡Šä¸­çš„ // capture of ? extends T æ˜¯æå…¶ä¸“ä¸šçš„æè¿°ã€‚è¿™é‡Œçš„é€»è¾‘é™·é˜±åœ¨äºï¼šåå˜å¼•ç”¨åªèƒ½ä½œä¸ºç”Ÿäº§è€…ï¼ˆProducerï¼‰ï¼Œä¸èƒ½ä½œä¸ºæ¶ˆè´¹è€…ï¼ˆConsumerï¼‰ã€‚
    // æ·±åº¦æ¨æ¼”ï¼šå‡è®¾ T æ˜¯ Catã€‚c1 çš„ç±»å‹æ˜¯ Comparator<? extends Cat>ã€‚è¿™æ„å‘³ç€ c1 èƒŒåå¯èƒ½æ˜¯ä¸€ä¸ª Comparator<Cat>ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ª Comparator<Manx>ï¼ˆManx æ˜¯æ— å°¾çŒ«ï¼ŒCat çš„å­ç±»ï¼‰ã€‚
    // å¦‚æœä½ è¯•å›¾è°ƒç”¨ c1.compare(cat1, cat2)ï¼Œä½ å®é™…ä¸Šæ˜¯åœ¨æŠŠä¸¤ä¸ª Cat å¯¹è±¡ï¼ˆå¯èƒ½æ˜¯æœ‰å°¾å·´çš„æ™®é€šçŒ«ï¼‰ä¼ é€’ç»™è¿™ä¸ªæ¯”è¾ƒå™¨ã€‚
    // ç¾éš¾åœºæ™¯ï¼šå¦‚æœ c1 åœ¨è¿è¡Œæ—¶å®é™…ä¸Šæ˜¯ Comparator<Manx>ï¼Œå®ƒçš„ compare æ–¹æ³•å†…éƒ¨å¯èƒ½ä¼šè®¿é—® Manx ç‰¹æœ‰çš„å­—æ®µï¼ˆä¾‹å¦‚ tailLength()ï¼‰ã€‚
    // å½“ä½ ä¼ å…¥ä¸€ä¸ªæ™®é€šçš„ Cat å®ä¾‹æ—¶ï¼Œè¯¥å®ä¾‹å¹¶æ²¡æœ‰è¿™ä¸ªå­—æ®µï¼Œè¿™å°†ç›´æ¥å¯¼è‡´è¿è¡Œæ—¶å´©æºƒï¼ˆRuntime Exceptionï¼‰ã€‚
    // ä¸ºäº†æœç»è¿™ç§å¯èƒ½æ€§ï¼Œç¼–è¯‘å™¨é‡‡ç”¨äº†ä¸€åˆ€åˆ‡çš„ç­–ç•¥ï¼š
    // å½“æ³›å‹å‚æ•°å‡ºç°åœ¨æ–¹æ³•çš„é€†å˜ä½ç½®ï¼ˆå³ä½œä¸ºæ–¹æ³•çš„å…¥å‚ï¼Œå¦‚ compare çš„å‚æ•°ï¼‰æ—¶ï¼Œå¦‚æœå¼•ç”¨ç±»å‹æ˜¯åå˜çš„ï¼ˆ? extendsï¼‰ï¼Œåˆ™ç¦æ­¢ä»»ä½•æ–¹æ³•è°ƒç”¨ã€‚
    // è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ æ— æ³•åœ¨ sort1 ä¸­è°ƒç”¨ compare çš„æ ¹æœ¬åŸå› â€”â€”ç¼–è¯‘å™¨æ— æ³•ç¡®è®¤ä½ ä¼ å…¥çš„å‚æ•°æ˜¯å¦æ»¡è¶³åº•å±‚å…·ä½“å­ç±»çš„çº¦æŸã€‚
    // Tip: åå˜ä½ç½®ï¼šè¿”å›å€¼ (Output). é€†å˜ä½ç½®ï¼šè¾“å…¥å‚æ•° (Input).
    public static <T> void sort1(List<T> list, Comparator<? extends T> c1) {
        T t1 = list.get(0);
        T t2 = list.get(1);
        // å› ä¸º compare çš„å‚æ•°å¤„äºé€†å˜ä½ç½®ï¼ˆå®ƒéœ€è¦æ¶ˆè´¹æ•°æ®ï¼‰ï¼Œè€Œä½ çš„å¼•ç”¨ç±»å‹ ? extends å´é”å®šäº†åå˜èŒƒå›´ï¼ˆå®ƒåªèƒ½ç”Ÿäº§æ•°æ®ï¼‰ï¼Œä¸¤è€…æ€§è´¨äº’æ–¥ã€‚
        // ä¸ºäº†é˜²æ­¢ä½ æŠŠ Catï¼ˆçˆ¶ï¼‰ä¼ ç»™ Comparator<Manx>ï¼ˆå­ï¼‰ï¼Œç¼–è¯‘å™¨ç›´æ¥å°é”äº†è¯¥ä½ç½®çš„æ‰€æœ‰è°ƒç”¨ã€‚
        // æ³›å‹é€†å˜ï¼šä»æ•°æ®è§†è§’åˆ°èƒ½åŠ›è§†è§’
        // å½“æˆ‘ä»¬è¯´ Cat æ˜¯ Pet çš„å­ç±»æ—¶ï¼Œæ˜¯å› ä¸º Cat æ‹¥æœ‰ Pet çš„æ‰€æœ‰å±æ€§ï¼Œæ‰€ä»¥ Cat å¯ä»¥æ›¿ä»£ Petã€‚
        // å½“æˆ‘ä»¬è¯´ Consumer<Pet> æ˜¯ Consumer<Cat> çš„å­ç±»ï¼ˆæ›´å‡†ç¡®è¯´æ˜¯å­ç±»å‹ï¼‰æ—¶ï¼Œ
        // æ˜¯å› ä¸º Consumer<Pet> æ‹¥æœ‰ å¤„ç† Cat çš„èƒ½åŠ›ï¼Œæ‰€ä»¥å®ƒå¯ä»¥æ›¿ä»£ Consumer<Cat>ã€‚
        //- c1.compare(t1, t2); // capture of ? extends T o1, capture of ? extends T o2
        // æ’åºé€»è¾‘...
    }

    // ã€ç°å®ä¸–ç•Œã€‘ä¼˜é›…çš„è®¾è®¡ï¼šæ¥å— T æˆ– T çš„çˆ¶ç±»æ¯”è¾ƒå™¨
    public static <T> void sort2(List<T> list, Comparator<? super T> c2) {
        T t1 = list.get(0);
        T t2 = list.get(1);
        int compareResult = c2.compare(t1, t2);
        // æ’åºé€»è¾‘...
    }

    public static void main(String[] args) {
        Comparator<Pet> petComparator = new Comparator<Pet>() {
            @Override
            public int compare(Pet o1, Pet o2) {
                return o1.compareTo(o2);
            }
        };

        // ğŸ’© åƒåœ¾ä»£ç è¯ç”Ÿäº†ï¼šé€»è¾‘å®Œå…¨ä¸€æ ·ï¼Œåªæ˜¯ä¸ºäº†è¿åˆç¼–è¯‘å™¨çš„ç±»å‹æ£€æŸ¥
        Comparator<Cat> catComparator = new Comparator<Cat>() {
            @Override
            public int compare(Cat o1, Cat o2) {
                return o1.compareTo(o2);
            }
        };

        Comparator<Manx> subCatComparator = new Comparator<Manx>() {
            @Override
            public int compare(Manx o1, Manx o2) {
                return o1.compareTo(o2);
            }
        };

        List<Cat> cats = new ArrayList<>();
        cats.add(new Cat());
        cats.add(new Manx());

        // 1. ä¸ºä»€ä¹ˆ sort0 å¤±è´¥ï¼Ÿâ€”â€” ä¸å˜æ€§ï¼ˆInvarianceï¼‰çš„åˆšæ€§å£å’
        // sort0(List<T> list, Comparator<T> c0) çš„æ–¹æ³•ç­¾åè¦æ±‚æ³›å‹å‚æ•°å¿…é¡»ä¸¥æ ¼ä¸€è‡´ã€‚åœ¨ Java æ³›å‹ç³»ç»Ÿä¸­ï¼Œæ³›å‹é»˜è®¤æ˜¯ä¸å¯å˜ï¼ˆInvariantï¼‰çš„ã€‚
        // è™½ç„¶ Pet æ˜¯ Cat çš„çˆ¶ç±»å‹ï¼ˆSupertypeï¼‰ï¼Œä½† Comparator<Pet> ç»ä¸æ˜¯ Comparator<Cat> çš„çˆ¶ç±»å‹ï¼ŒäºŒè€…åœ¨ç±»å‹ç³»ç»Ÿä¸­æ˜¯æ¯«æ— å…³ç³»çš„â€œé™Œç”Ÿäººâ€ã€‚
        // æ ¹æœ¬åŸå› ï¼šå¦‚æœç¼–è¯‘å™¨å…è®¸å°† Comparator<Pet> è§†ä¸º Comparator<Cat>ï¼ˆåå˜ï¼‰ï¼Œé‚£ä¹ˆåœ¨å…¶ä»–åœºæ™¯ä¸‹ï¼ˆç‰¹åˆ«æ˜¯æ¶‰åŠå†™å…¥æ“ä½œæ—¶ï¼‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´å †æ±¡æŸ“ã€‚
        // è™½ç„¶åœ¨ compare è¿™ç§åªè¯»åœºæ™¯ä¸‹çœ‹èµ·æ¥æ˜¯å®‰å…¨çš„ï¼Œä½†ç¼–è¯‘å™¨å¿…é¡»åšå®ˆâ€œæ³›å‹ç±»å‹å¿…é¡»ç²¾ç¡®åŒ¹é…â€çš„é“å¾‹ï¼Œé™¤éä½ æ˜¾å¼ä½¿ç”¨é€šé…ç¬¦ã€‚
        // å› æ­¤ï¼Œå½“ä½ è¯•å›¾æŠŠä¸€ä¸ªèƒ½å¤„ç†æ³›ç”¨å‹ Pet çš„æ¯”è¾ƒå™¨ä¼ ç»™åªèƒ½å¤„ç† Cat çš„åˆ—è¡¨æ—¶ï¼Œç¼–è¯‘å™¨å› ä¸ºç±»å‹ä¸åŒ¹é…è€ŒæŠ¥é”™ã€‚è¿™æ˜¯ä¸€ç§ä¸ºäº†å®‰å…¨è€Œç‰ºç‰²çµæ´»æ€§çš„è®¾è®¡ã€‚
        //- sort0(cats, petComparator);
        // required: List<T>,Comparator<T>
        // found:    List<Cat>,Comparator<Pet>
        sort0(cats, catComparator);

        // 3. ä¸ºä»€ä¹ˆ sort2 æˆåŠŸï¼Ÿâ€”â€” é€†å˜ï¼ˆContravarianceï¼‰ä¸å‡½æ•°ç±»å‹çš„æœ¬è´¨
        // sort2(List<T> list, Comparator<? super T> c2) ä½¿ç”¨äº†ä¸‹ç•Œé€šé…ç¬¦ï¼Œè¿™è¢«ç§°ä¸ºé€†å˜ä¸Šä¸‹æ–‡ã€‚è¿™æ˜¯ Comparator çš„æ ‡å‡†æ‰“å¼€æ–¹å¼ã€‚
        // æ ¸å¿ƒåŸç†ï¼šè¿™é‡Œä½“ç°äº†å‡½æ•°ç±»å‹çš„é€†å˜æ€§åŸç†ã€‚Comparator æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•° (T, T) -> intã€‚åœ¨è®¡ç®—æœºç§‘å­¦çš„ç±»å‹ç†è®ºä¸­ï¼Œå‡½æ•°çš„å‚æ•°ç±»å‹å¿…é¡»æ˜¯é€†å˜çš„ã€‚
        // è§£é‡Šï¼šä½ è¦å¤„ç† List<Cat>ï¼Œä½ éœ€è¦ä¸€ä¸ªèƒ½â€œæ¶ˆè´¹â€ Cat çš„æœºå™¨ã€‚
        // - Comparator<Cat> çš„å…¥æ–™å£å½¢çŠ¶æ˜¯ Catã€‚
        // - Comparator<Pet> çš„å…¥æ–™å£å½¢çŠ¶æ˜¯ Petï¼ˆæ¯” Cat å®½ï¼‰ã€‚
        // - Comparator<Object> çš„å…¥æ–™å£å½¢çŠ¶æ˜¯ Objectï¼ˆæœ€å®½ï¼‰ã€‚é€»è¾‘ä¸Šï¼Œä»»ä½•èƒ½å¤„ç† Pet çš„æœºå™¨ï¼Œä¸€å®šèƒ½å¤„ç† Catï¼ˆå› ä¸º Cat æ˜¯ Petï¼‰ã€‚
        // å› æ­¤ï¼ŒComparator<Pet> åœ¨é€»è¾‘ä¸Šå¯ä»¥å®‰å…¨åœ°æ›¿ä»£ Comparator<Cat>ã€‚? super T æ˜¾å¼å‘Šè¯‰ç¼–è¯‘å™¨ï¼šâ€œæˆ‘æ¥å— T çš„ä»»ä½•çˆ¶ç±»å‹æ¯”è¾ƒå™¨â€ã€‚
        // è¿™è§£é™¤ç¼–è¯‘å™¨çš„å°é”ï¼Œå› ä¸ºç¼–è¯‘å™¨å¯ä»¥ç¡®ä¿¡ï¼šæ— è®º c2 å®é™…æŒ‡å‘çš„æ˜¯ Pet æ¯”è¾ƒå™¨è¿˜æ˜¯ Object æ¯”è¾ƒå™¨ï¼Œå®ƒä»¬çš„ç±»å‹ä¸‹ç•Œï¼ˆLower Boundï¼‰ è‡³å°‘æ˜¯ Tã€‚
        // å› æ­¤ï¼Œå‘å…¶ä¼ é€’ T ç±»å‹çš„å®ä¾‹ï¼ˆt1, t2ï¼‰æ°¸è¿œæ˜¯ç±»å‹å®‰å…¨çš„ï¼ˆé‡Œæ°æ›¿æ¢åŸåˆ™ï¼šå­ç±»å¯¹è±¡å¯ä»¥æ›¿æ¢çˆ¶ç±»å¯¹è±¡å‡ºç°çš„ä½ç½®ï¼‰ã€‚
        sort2(cats, petComparator);
        sort2(cats, catComparator);

        // 4. ä¸ºä»€ä¹ˆ sort2(cats, subCatComparator) å¤±è´¥ï¼Ÿâ€”â€” é€†å˜çš„è¾¹ç•Œé™åˆ¶
        // æœ€åï¼Œä½ å°è¯•å°† Comparator<Manx> ä¼ ç»™ sort2 å¤„ç† List<Cat>ï¼ŒæŠ¥é”™æ˜¯å¿…ç„¶çš„ã€‚
        // åˆ†æï¼šT æ˜¯ Catã€‚æ–¹æ³•ç­¾åè¦æ±‚ Comparator<? super Cat>ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½å¤„ç† Cat æˆ–å…¶çˆ¶ç±»çš„æ¯”è¾ƒå™¨ã€‚
        // ä½ ä¼ å…¥çš„æ˜¯ Comparator<Manx>ã€‚Manx æ˜¯ Cat çš„å­ç±»ã€‚é€»è¾‘çŸ›ç›¾ï¼šsubCatComparator æ˜¯ä¸€ä¸ªâ€œä¸“ç”¨å·¥å…·â€ï¼Œå®ƒåªèƒ½å¤„ç†æ— å°¾çŒ« (Manx)ã€‚
        // ä½ çš„åˆ—è¡¨é‡Œè£…çš„æ˜¯é€šç”¨çš„ Catï¼ˆå…¶ä¸­å¯èƒ½åŒ…å«æœ‰å°¾å·´çš„æ³¢æ–¯çŒ«ï¼‰ã€‚å¦‚æœä½ æŠŠä¸€åªæ³¢æ–¯çŒ«æ‰”è¿›â€œæ— å°¾çŒ«ä¸“ç”¨æ¯”è¾ƒå™¨â€ï¼Œæ¯”è¾ƒå™¨å†…éƒ¨å¦‚æœæ‰§è¡Œ o1.isTailless()ï¼Œæ³¢æ–¯çŒ«å°±ä¼šæŠ¥é”™ã€‚
        // ç»“è®ºï¼šä½ ä¸èƒ½ç”¨ä¸€ä¸ªå¤„ç†èŒƒå›´æ›´çª„ï¼ˆå­ç±»ï¼‰çš„æ¯”è¾ƒå™¨ï¼Œå»å¤„ç†ä¸€ä¸ªèŒƒå›´æ›´å¹¿ï¼ˆçˆ¶ç±»ï¼‰çš„é›†åˆã€‚è¿™è¿åäº†é€†å˜åŸåˆ™ã€‚
        // æ¶ˆè´¹è€…ï¼ˆComparatorï¼‰çš„èƒƒå£ï¼ˆå‚æ•°ç±»å‹ï¼‰å¿…é¡»æ¯”ä½ å–‚ç»™å®ƒçš„é£Ÿç‰©ï¼ˆList å…ƒç´ ç±»å‹ï¼‰æ›´å¤§æˆ–ç›¸ç­‰ï¼Œå†³ä¸èƒ½æ›´å°ã€‚
        //- sort2(cats, subCatComparator);
        // required: List<T>,Comparator<? super T>
        // found:    List<Cat>,Comparator<Manx>
    }
}
